namespace = skc

###########Soleil Royale Events############

narrative_event = { #Solarque 
	id = skc.1
	title = EVTNAME_skc_1
	desc = EVTDESC_skc_1
	picture = GFX_evt_council
	border = GFX_event_narrative_frame_religion
	
	major = yes

	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_skc_1
		trigger = {
			religion = sun_king_cultist
		}
	}
	option = {
		name = EVTOPTB_skc_1
		trigger = {
			religion_group = vernacular
			NOT = { religion = sun_king_cultist }
		}
	}
	option = {
		name = EVTOPTC_skc_1
		trigger = {
			NOT = {
				religion_group = vernacular
			}
		}
	}
}

########Chevalier Events##########

#Worthy Knight Events
character_event = { #character named as a Worthy 
	id = skc.100
	desc = EVTDESC_worthy_chevalier
	picture = GFX_nine_worthies
	border = GFX_event_normal_frame_religion
	
	only_playable = yes
	only_capable = yes
	prisoner = no
	min_age = 16
	religion = chevalier

	trigger = {
		calc_true_if = {
			amount >= 3
			trait = brave
			trait = honorable
			trait = honest
			trait = just
			trait = chaste
			trait = temperate
			trait = charitable
			trait = diligent
			trait = patient
			trait = kind
			trait = humble
		}
		prestige = 750
		martial = 15
		religion = chevalier
		NOR = {
			has_character_modifier = adulterer
			has_character_modifier = adultress
			has_character_modifier = incestuous_adulterer
			has_character_modifier = incestuous_adultress
			has_character_modifier = known_murderer
			has_character_modifier = uncivilized_dueler
			has_character_modifier = shamed_knight
			trait = kinslayer
			trait = greedy
			trait = envious
			trait = wroth
			trait = slothful
			trait = greedy
			trait = gluttonous
			trait = lustful
			trait = cruel
			trait = drunkard
			trait = craven
			trait = hedonist
			trait = impaler
			trait = paranoid
		}
		NOT = { trait = worthy_knight }
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	option = {
		name = EVTOPTA_worthy_chevalier
		add_trait = worthy_knight
		prestige = 100
		piety = 100
	}
}

character_event = { # Knight character arrives
	id = skc.101
	desc = EVTDESC_knight_arrives_worthy
	picture = GFX_evt_western_knights_byzantine
	border = GFX_event_normal_frame_war

	only_playable = yes
	only_capable = yes
	prisoner = no
	min_age = 16
	
	trigger = {
		religion = chevalier
		trait = worthy_knight
		NOR = {

			trait = greedy
			trait = envious
			trait = wroth
			trait = slothful
			trait = greedy
			trait = gluttonous
			trait = lustful
			trait = cruel
			trait = drunkard
			trait = craven
			trait = hedonist
			trait = impaler
			trait = paranoid
		}
	}
	
	mean_time_to_happen = {
		years = 10
		modifier = {
			factor = 0.5
			AND = {
				prestige = 2000
				martial = 20
			}
		}
	}
		

	immediate = {
		spawn_fantastic_commander_effect = yes
		event_target:invited_character = {
			set_character_flag = bloodline_great_hero
			set_character_flag = hero_knight
			remove_trait = cruel
			remove_trait = craven
			add_trait = kind
			add_trait = cavalry_leader
		}
	}
	
	option = {
		name = EVTOPTA_knight_arrives_worthy
		
		trigger = {
			OR = { 
				NOT = { ROOT = { has_law = succ_byzantine_elective } }  #Either not Imperial...
				NOT = { #...Or there are no valid vassal candidates that can be commanders.
					any_vassal = { 
						higher_real_tier_than = BARON
						NOT = { 
							primary_title = { temporary = yes } 
						}
						OR = {
							AND = {
								OR = {
									male_can_hold_minor_title_trigger = yes
									female_can_hold_minor_commander_title_trigger = yes
								}
								OR = {
									NOT = { religion = hindu }
									trait = kshatriya
								}
								is_adult = yes
							}
							has_character_flag = special_marshal
						}
				
						prisoner = no
						NOT = { trait = incapable }
						NOT = { is_inaccessible_trigger = yes }
						NOT = { has_character_flag = guru }
						NOT = { has_character_modifier = refusing_to_lead }
						NOR = {
							has_job_title = job_chancellor
							has_job_title = job_marshal
							has_job_title = job_treasurer
							has_job_title = job_spymaster
							has_job_title = job_spiritual
							has_minor_title = title_commander
						}
					} 
				}
			}
			any_realm_character = {
				NOT = {
					higher_tier_than = BARON
				}
				liege = { character = ROOT }
				has_minor_title = title_commander
				NOT = {
					martial = 12
				}
			}
			OR = {
				AND = {
					tier = COUNT
					any_realm_character = {
						count = 2
						liege = { character = ROOT }
						has_minor_title = title_commander
					}
				}
				AND = {
					tier = DUKE
					any_realm_character = {
						count = 4
						liege = { character = ROOT }
						has_minor_title = title_commander
					}
				}
				AND = {
					tier = KING
					is_nomadic = no
					any_realm_character = {
						count = 6
						liege = { character = ROOT }
						has_minor_title = title_commander
					}
				}
				AND = {
					tier = EMPEROR
					is_nomadic = no
					any_realm_character = {
						count = 8
						liege = { character = ROOT }
						has_minor_title = title_commander
					}
				}
				AND = {
					tier = KING
					is_nomadic = yes
					any_realm_character = {
						count = 2
						liege = { character = ROOT }
						has_minor_title = title_commander
					}
				}
				AND = {
					tier = EMPEROR
					is_nomadic = yes
					any_realm_character = {
						count = 4
						liege = { character = ROOT }
						has_minor_title = title_commander
					}
				}
			}
		}
		
		random_realm_character = {
			limit = {
				NOT = {
					higher_tier_than = BARON
				}
				liege = { character = ROOT }
				has_minor_title = title_commander
				NOT = {
					martial = 12
				}
			}
			remove_title = title_commander
			opinion = {
				modifier = insulted
				who = ROOT
				years = 2
			}
		}
		
		event_target:invited_character = {
			give_minor_title = title_commander
			opinion = {
				modifier = opinion_loyal_servant
				who = ROOT
				years = 100
			}
		}
	}

	option = {
		name = EVTOPTA_knight_arrives_worthy
		
		trigger = {
			OR = { 
				NOT = { ROOT = { has_law = succ_byzantine_elective } }  #Either not Imperial...
				NOT = { #...Or there are no valid vassal candidates that can be commanders.
					any_vassal = { 
						higher_real_tier_than = BARON
						NOT = { 
							primary_title = { temporary = yes } 
						}
						OR = {
							AND = {
								OR = {
									male_can_hold_minor_title_trigger = yes
									female_can_hold_minor_commander_title_trigger = yes
								}
								OR = {
									NOT = { religion = hindu }
									trait = kshatriya
								}
								is_adult = yes
							}
							has_character_flag = special_marshal
						}
				
						prisoner = no
						NOT = { trait = incapable }
						NOT = { is_inaccessible_trigger = yes }
						NOT = { has_character_flag = guru }
						NOT = { has_character_modifier = refusing_to_lead }
						NOR = {
							has_job_title = job_chancellor
							has_job_title = job_marshal
							has_job_title = job_treasurer
							has_job_title = job_spymaster
							has_job_title = job_spiritual
							has_minor_title = title_commander
						}
					} 
				}
			}
			event_target:invited_character = { has_character_flag = invited_soldier }
			OR = {
				AND = {
					tier = COUNT
					NOT = {
						any_realm_character = {
							count = 2
							liege = { character = ROOT }
							has_minor_title = title_commander
						}
					}
				}
				AND = {
					tier = DUKE
					NOT = {
						any_realm_character = {
							count = 4
							liege = { character = ROOT }
							has_minor_title = title_commander
						}
					}
				}
				AND = {
					tier = KING
					is_nomadic = no
					NOT = {
						any_realm_character = {
							count = 6
							liege = { character = ROOT }
							has_minor_title = title_commander
						}
					}
				}
				AND = {
					tier = EMPEROR
					is_nomadic = no
					NOT = {
						any_realm_character = {
							count = 8
							liege = { character = ROOT }
							has_minor_title = title_commander
						}
					}
				}
				AND = {
					tier = KING
					is_nomadic = yes
					NOT = {
						any_realm_character = {
							count = 2
							liege = { character = ROOT }
							has_minor_title = title_commander
						}
					}
				}
				AND = {
					tier = EMPEROR
					is_nomadic = yes
					NOT = {
						any_realm_character = {
							count = 4
							liege = { character = ROOT }
							has_minor_title = title_commander
						}
					}
				}
			}
		}
		
		event_target:invited_character = {
			give_minor_title = title_commander
			opinion = {
				modifier = opinion_loyal_servant
				who = ROOT
				years = 100
			}
		}
	}
	
	option = {
		name = FANTASTIC
		event_target:invited_character = {
			opinion = {
				modifier = opinion_loyal_servant
				who = ROOT
				years = 100
			}
		}
	}
	
	option = {
		name = EVTOPTB_knight_arrives_worthy
		
		hidden_tooltip = {
			event_target:invited_character = { 
				death = {
					death_reason = death_missing
				}
			}
		}
	}
}

character_event = { # Bard character arrives
	id = skc.102
	desc = EVTDESC_bard_arrives_worthy
	picture = GFX_evt_jugglers
	border = GFX_event_normal_frame_diplomacy
	
	only_playable = yes
	only_capable = yes
	prisoner = no
	min_age = 16
	
	trigger = {
		religion = chevalier
		trait = worthy_knight
		NOR = {

			trait = greedy
			trait = envious
			trait = wroth
			trait = slothful
			trait = greedy
			trait = gluttonous
			trait = lustful
			trait = cruel
			trait = drunkard
			trait = craven
			trait = hedonist
			trait = impaler
			trait = paranoid
		}
	}
	
	mean_time_to_happen = {
		years = 10
		modifier = {
			factor = 0.5
			AND = {
				prestige = 2000
				martial = 20
			}
		}
	}
	
	immediate = {
		spawn_fantastic_diplomat_effect = yes
		event_target:invited_character = {
			add_trait = poet
		}
	}
	
	option = {
		name = EVTOPTA_bard_arrives_worthy
		event_target:invited_character = {
			opinion = {
				modifier = opinion_loyal_servant
				who = ROOT
				years = 100
			}
		}
	}
	option = {
		name = EVTOPTB_knight_arrives_worthy
		
		hidden_tooltip = {
			event_target:invited_character = { 
				death = {
					death_reason = death_missing
				}
			}
		}
	}
}

#Landless ladies  might ask for protection.
character_event = { 
	id = skc.103
	hide_window = yes

	is_triggered_only = yes
	
	only_women = yes
	min_age = 16
	max_age = 30
	only_capable = yes
	prisoner = no
	
	trigger = {
		is_ruler = no
		is_female = yes
		NOT = { has_religion_feature = religion_matriarchal }
		is_married = no
		NOT = { num_of_children = 1 }
		NOT = { num_of_lovers = 1 }
		NOT = { num_of_friends = 1 }
		NOR = { 
			trait = nun 
			trait = brave
			trait = content
		}
		NOT = { has_character_flag = special_marshal }
		liege = {  
			OR = { 
				NOT = { religion = ROOT }
				NOT = { reverse_opinion = { who = ROOT value = -40 } }
				is_rival = ROOT
			}
			any_neighbor_independent_ruler = {  
				AND = {
					NOT = { trait = incapable }
					religion = chevalier
					trait = worthy_knight
				}
			}
		}

	}

	immediate = {
		random = {
			chance = 5
			random_neighbor_independent_ruler = {  
				limit = {  
					NOT = { trait = incapable }
					religion = chevalier
					trait = worthy_knight
				}
				character_event = { id = skc.104 } #adding a duel in here
			}
		}
	}
}

character_event = { # Woman asks for assistance
	id = skc.104
	desc = EVTDESC_damsel_distress_1
	picture = GFX_evt_bloodlines
	border = GFX_event_normal_frame_diplomacy

	is_triggered_only = yes
	
	#Marry her.
	#Host her.
	#Refuse her.
	
	
	
	option = {
		name = EVTOPTA_damsel_distress_1
		FROM = {
			save_event_target_as = damsel_in_distress
		}
		character_event = { id = skc.105 days = 7 }
	}

	option = {
		name = EVTOPTB_damsel_distress_1
		tiered_piety_negative_effect = yes
		FROM = {
			opinion = {
				modifier = opinion_dishonorable_scum
				who = ROOT
				years = 100
			}
		}
	}
}

character_event = { # Duel for the Damsel!
	id = skc.105
	desc = EVTDESC_damsel_distress_2
	picture = GFX_evt_duel_scene
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	portrait = event_target:combatant_2

	#Marry her.
	#Host her.
	#Refuse her.
	
	
    immediate = {
        event_target:damsel_in_distress = { #choose a target...
            any_host_courtier = {
                limit = { 
                    prisoner = no
                    society_rank == 4
                    ai = yes
                    NOT = { trait = incapable }
                    NOT = { has_character_flag = call_to_legend_active }
                }
                score_value = { #Prioritizes selecting some kind of warrior...
                    value = 100
                    has_assigned_minor_title = { title = title_commander }
                }
                save_event_target_as = combatant_2
            }
        }
        save_event_target_as = combatant_1
    }

    option = {
        name = EVTOPTA_damsel_distress_2 #I have been itching for a fight anyway!
        character_event = { id = HFP.10100 } #Send actual duel events... 
		character_event = { id = skc.106 days = 2 }
    }
	


	option = {
		name = EVTOPTB_damsel_distress_2
		tiered_piety_negative_effect = yes
		event_target:damsel_in_distress = {
			opinion = {
				modifier = opinion_dishonorable_scum
				who = ROOT
				years = 100
			}
		}
	}
}


character_event = { # victory or defeat
	id = skc.106
	picture = GFX_evt_homage_hf
	border = GFX_event_normal_frame_diplomacy
	is_triggered_only = yes

	desc = {
		trigger = { has_character_modifier = recent_duel_victory }
		text = EVTDES1_damsel_distress_3
		picture = GFX_evt_homage_hf
    }
    desc = {
		trigger = { NOT = { has_character_modifier = recent_duel_victory } }
		text = EVTDES2_damsel_distress_3
		picture = GFX_evt_bad_news_soa
    }
	is_triggered_only = yes
	
	
	#Marry her.
	#Host her.
	#Refuse her.
	
	option = {
		name = EVTOPTA_damsel_distress_3
		trigger = {
			has_character_modifier = recent_duel_victory
			is_benevolent_trigger = yes
			is_married = no
			is_female = no
			event_target:damsel_in_distress = { is_married = no }
		}
		event_target:damsel_in_distress = {
			show_scope_change = no
			liege = {
				show_scope_change = no
				opinion = {
					modifier = opinion_outraged
					who = ROOT
					years = 100
				}
			}
		}
		event_target:damsel_in_distress = {
			show_scope_change = no
			opinion = {
				modifier = opinion_saved_me
				who = ROOT
				years = 100
			}
			move_character = ROOT
			if = {
				limit = {
					is_betrothed = yes
				}
				break_betrothal = yes
			}
			if = {
				limit = {
					is_married = yes #Multiplayer delay
				}
				remove_spouse = yes
			}
			add_spouse = ROOT
			add_lover = ROOT
		}
	}
	option = {
		trigger = {
			has_character_modifier = recent_duel_victory
		}
		name = EVTOPTB_damsel_distress_3
		FROM = {
			show_scope_change = no
			liege = {
				show_scope_change = no
				opinion = {
					modifier = opinion_outraged
					who = ROOT
					years = 100
				}
			}
		}
		FROM = {
			show_scope_change = no
			opinion = {
				modifier = opinion_saved_me
				who = ROOT
				years = 100
			}
			move_character = ROOT
			if = {
				limit = {
					is_betrothed = yes
				}
				break_betrothal = yes
			}
			if = {
				limit = {
					is_married = yes #Multiplayer delay
				}
				remove_spouse = yes
			}
		}
	}
	option = {
		trigger = {
			NOT =  { has_character_modifier = recent_duel_victory }
		}
		name = EVTOPTC_damsel_distress_3
		event_target:damsel_in_distress = {
			show_scope_change = no
			liege = {
				show_scope_change = no
				opinion = {
					modifier = opinion_outraged
					who = ROOT
					years = 100
				}
			}
		}
	}
}



character_event = { #character rejected as a Worthy 
	id = skc.107
	desc = EVTDESC_unworthy_chevalier
	picture = GFX_nine_worthies
	border = GFX_event_normal_frame_religion
	
	only_playable = yes
	only_capable = yes
	prisoner = no
	min_age = 16
	religion = chevalier

	trigger = {
		OR = {
			has_character_modifier = adulterer
			has_character_modifier = adultress
			has_character_modifier = incestuous_adulterer
			has_character_modifier = incestuous_adultress
			has_character_modifier = known_murderer
			has_character_modifier = uncivilized_dueler			
			trait = kinslayer
			trait = greedy
			trait = envious
			trait = wroth
			trait = slothful
			trait = greedy
			trait = gluttonous
			trait = lustful
			trait = cruel
			trait = drunkard
			trait = craven
			trait = hedonist
			trait = impaler
			trait = paranoid
		}
		trait = worthy_knight
	}
	
	mean_time_to_happen = {
		months = 36
		modifier = {
			factor = .001
			OR = {
				has_character_modifier = adulterer
				has_character_modifier = adultress
				has_character_modifier = incestuous_adulterer
				has_character_modifier = incestuous_adultress
				has_character_modifier = known_murderer
				has_character_modifier = uncivilized_dueler
				trait = kinslayer
			}
		}
		modifier = {
			factor = .25
			calc_true_if = {
				amount >= 2
				trait = greedy
				trait = envious
				trait = wroth
				trait = slothful
				trait = greedy
				trait = gluttonous
				trait = lustful
				trait = cruel
				trait = drunkard
				trait = craven
				trait = hedonist
				trait = impaler
				trait = paranoid
			}
		}
	}
	
	option = {
		name = EVTOPTA_unworthy_chevalier
		remove_trait = worthy_knight
		prestige = -100
		piety = -100
		add_character_modifier = {
			name = shamed_knight
			years = 10
		}
	}
}