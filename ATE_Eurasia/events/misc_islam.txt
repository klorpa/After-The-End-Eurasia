namespace = islamate
character_event = {
	id = islamate.1
	desc = EVTDESC_islamate1
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	has_dlc = "The Sword of Islam"
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "The Sword of Islam"
		capital_scope = {
			region = custom_benelux
			region = custom_old_germany
			region = custom_old_france
			region = custom_old_spain
		}
		OR = {
			religion_group = christian
			religion_group = vernacular
			religion_group = old_world_cultist_group
			religion_group = jewish_group
			religion = neuhumanist
			religion = valinorism
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 420
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = francarabe
			dynasty = actually_culture 
			religion = ruhi
			female = no
			age = 30
			trait = charismatic_negotiator
			attributes = {
				diplomacy = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			#character_event = { id = misc.3 } Diversity
			#character_event = { id = misc.4 } Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = poet
				}
				30 = {
					add_trait = poet
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.2
	desc = EVTDESC_islamate2
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	has_dlc = "The Sword of Islam"
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "The Sword of Islam"
		capital_scope = {
			region = custom_benelux
			region = custom_old_germany
			region = custom_old_france
			region = custom_old_spain
		}
		OR = {
			religion_group = christian
			religion_group = vernacular
			religion_group = old_world_cultist_group
			religion_group = jewish_group
			religion = neuhumanist
			religion = valinorism
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 420
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = francarabe
			dynasty = actually_culture 
			religion = ruhi
			female = no
			age = 30
			trait = fortune_builder
			attributes = {
				stewardship = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			#character_event = { id = misc.3 } # Diversity
			#character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = administrator
				}
				30 = {
					add_trait = administrator
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}

character_event = {
	id = islamate.3
	desc = EVTDESC_islamate3
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	has_dlc = "The Sword of Islam"
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "The Sword of Islam"
		capital_scope = {
			region = custom_benelux
			region = custom_old_germany
			region = custom_old_france
			region = custom_old_spain
		}
		OR = {
			religion_group = christian
			religion_group = vernacular
			religion_group = old_world_cultist_group
			religion_group = jewish_group
			religion = neuhumanist
			religion = valinorism
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 420
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = francarabe
			dynasty = actually_culture 
			religion = ruhi
			female = no
			age = 30
			trait = charismatic_negotiator
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			#character_event = { id = misc.3 } # Diversity
			#character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = poet
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = scholar
					add_trait = theologian
				}
				30 = {
					add_trait = scholar
					add_trait = theologian
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.4
	desc = EVTDESC_islamate4
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	has_dlc = "The Sword of Islam"
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "The Sword of Islam"
		capital_scope = {
			region = custom_benelux
			region = custom_old_germany
			region = custom_old_france
			region = custom_old_spain
		}
		OR = {
			religion_group = christian
			religion_group = vernacular
			religion_group = old_world_cultist_group
			religion_group = jewish_group
			religion = neuhumanist
			religion = valinorism
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 420
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = francarabe
			dynasty = actually_culture 
			religion = ruhi
			female = no
			age = 30
			trait = intricate_webweaver
			attributes = {
				intrigue = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			#character_event = { id = misc.3 } # Diversity
			#character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = schemer
				}
				30 = {
					add_trait = schemer
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.5
	desc = EVTDESC_islamate5
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	has_dlc = "The Sword of Islam"
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "The Sword of Islam"
		capital_scope = {
			region = custom_benelux
			region = custom_old_germany
			region = custom_old_france
			region = custom_old_spain
		}
		OR = {
			religion_group = christian
			religion_group = vernacular
			religion_group = old_world_cultist_group
			religion_group = jewish_group
			religion = neuhumanist
			religion = valinorism
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 420
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = francarabe
			dynasty = actually_culture 
			religion = nizami
			female = no
			age = 30
			trait = intricate_webweaver
			attributes = {
				intrigue = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			#character_event = { id = misc.3 } # Diversity
			#character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = musician
				}
				30 = {
					add_trait = musician
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}

character_event = {
	id = islamate.6
	desc = EVTDESC_islamate6
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	has_dlc = "The Sword of Islam"
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "The Sword of Islam"
		capital_scope = {
			region = custom_benelux
			region = custom_old_germany
			region = custom_old_france
			region = custom_old_spain
		}
		OR = {
			religion_group = christian
			religion_group = vernacular
			religion_group = old_world_cultist_group
			religion_group = jewish_group
			religion = neuhumanist
			religion = valinorism
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 420
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = francarabe
			dynasty = actually_culture 
			religion = ruhi
			female = no
			age = 30
			trait = charismatic_negotiator
			attributes = {
				learning = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			#character_event = { id = misc.3 } # Diversity
			#character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = strategist
			random_list = {
				70 = {
					add_trait = mystic
					add_trait = physician
				}
				30 = {
					add_trait = mystic
					add_trait = physician
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}
character_event = {
	id = islamate.7
	desc = EVTDESC_islamate7
	picture = GFX_evt_emissary
	border = GFX_event_normal_frame_religion
	has_dlc = "The Sword of Islam"
	min_age = 16
	prisoner = no
	only_playable = yes
	capable_only = yes
	only_independent = yes
	
	trigger = {
		has_dlc = "The Sword of Islam"
		capital_scope = {
			region = custom_benelux
			region = custom_old_germany
			region = custom_old_france
			region = custom_old_spain
		}
		OR = {
			religion_group = christian
			religion_group = vernacular
			religion_group = old_world_cultist_group
			religion_group = jewish_group
			religion = neuhumanist
			religion = valinorism
		}
		NOT = { trait = zealous } #obvious
		NOT = { is_inaccessible_trigger = yes }
	}
	
	mean_time_to_happen = {
		months = 420
	}
	
	immediate = {
		create_character = {
			random_traits = yes
			culture = francarabe
			dynasty = actually_culture 
			religion = ruhi
			female = no
			age = 30
			trait = charismatic_negotiator
			attributes = {
				martial = 10
			}
			flag = ai_flag_refuse_conversion
		}
		new_character = {
			#character_event = { id = misc.3 } # Diversity
			#character_event = { id = misc.4 } # Physique
			remove_trait = socializer
			remove_trait = gamer
			remove_trait = hedonist
			remove_trait = duelist
			remove_trait = hunter
			remove_trait = strategist
			remove_trait = administrator
			remove_trait = architect
			remove_trait = gardener
			remove_trait = schemer
			remove_trait = impaler
			remove_trait = seductress
			remove_trait = scholar
			remove_trait = theologian
			remove_trait = mystic
			random_list = {
				70 = {
					add_trait = strategist
					add_trait = brave
				}
				30 = {
					add_trait = strategist
					add_trait = brave
					add_trait = shrewd
				}
			}
			save_event_target_as = muslim_courtier
		}
	}
	
	option = {
		name = EVTOPTA_SoA_200
		custom_tooltip = {
			text = muslim_courtier_tooltip
		}
	}
}

#Start of Ashura event chain
character_event = { 
	id = islamate.20
	desc = EVTDESC_ashura_1
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.21 days = 1 } }
	}
	
	option = { #event 1 happens, then event 2 happens 2 days later, then event 3 happens 3 days later, then event 4 happens another 3 days later, then event 5 happens a day after that. 1+2 = 3, 3+3 = 6, 6+3 = 9, 9+1 = 10. makes sense.
		name = EVTOPTA_ashura_1
		custom_tooltip = { text = TXT_ashura_begins }
	}
}

#Ashura Day 1
character_event = { 
	id = islamate.21
	desc = EVTDESC_ashura_2
	picture = GFX_evt_melee_arabic
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.22 days = 4 } }
	}
	
	option = {
		name = EVTOPTA_ashura_2
		trigger = { NOT = { trait = craven } }
		if = {
			limit = {
				NOT = { trait = brave }
			}
			random_list = {
				50 = { add_trait = brave }
				50 = { }
			}
			piety = 25
		}
		else_if = {
			limit = {
				trait = brave
			}
			piety = 30
		}
	}
	
	option = {
		name = EVTOPTB_ashura_2
		trigger = { NOT = { trait = brave } }
		if = {
			limit = {
				NOT = { trait = craven }
			}
			add_trait = craven
			piety = -20
		}
		else_if = {
			limit = {
				trait = craven
			}
			piety = -20
		}
	}
}


character_event = { 
	id = islamate.22
	desc = EVTDESC_ashura_3
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.23 days = 4 } }
	}
	
	option = {
		name = EVTOPTA_ashura_3
		trigger = {
			OR = {
				trait = zealous
			}
		}
		if = {
			limit = {
				NOT = { trait = zealous }
			}
			random_list = {
				50 = { add_trait = zealous }
				50 = { piety = 50 }
			}
		}
		else_if = {
			limit = {
				trait = zealous
			}
			piety = 100
		}
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			random_list = {
				35 = { }
				50 = { add_trait = wounded }
				15 = { add_trait_severely_injured_effect = yes }
			}
		}
		else_if = {
			limit = {
				NOT = { has_dlc = "Reapers" }
			}
			random_list = {
				35 = { }
				50 = { add_trait = wounded }
				15 = { add_maimed_trait_effect = yes }
			}
		}
	}
	
	option = {
		name = EVTOPTB_ashura_3
		prestige = -50
		piety = 50
	}
}


character_event = { 
	id = islamate.23
	desc = EVTDESC_ashura_4
	picture = GFX_evt_market_arabic
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.24 days = 1 } }
	}
	
	option = {
		name = EVTOPTA_ashura_4
		trigger = { NOT = { trait = greedy } }
		piety = 50
		wealth = -25
		random_list = {
			50 = { add_trait = charitable }
			50 = { }
		}
	}
	
	option = {
		name = EVTOPTB_ashura_4
		trigger = { NOT = { trait = charitable } }
		piety = -25
		random_list = {
			50 = { add_trait = greedy }
			50 = { }
		}
	}
}

character_event = { 
	id = islamate.24
	desc = EVTDESC_ashura_5
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_in_progress
	}
	
	immediate = {
		clr_character_flag = ashura_in_progress
		clr_character_flag = do_not_disturb
		clr_character_flag = recent_minor_decision
		set_character_flag = ashura_fast
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = islamate.25 days = 40 } }
	}
	
	option = {
		name = EVTOPTA_ashura_5
		random_list = {
			25 = {
				if = {
					limit = {
						NOT = { trait = brave }
					}
					add_trait = brave
				}
				else_if = {
					limit = {
						trait = brave
					}
					prestige = 50
				}
			}
			25 = {
				if = {
					limit = {
						NOT = { trait = ambitious }
					}
					add_trait = ambitious
				}
				else_if = {
					limit = {
						trait = ambitious
					}
					prestige = 50
				}
			}
			25 = {
				if = {
					limit = {
						NOT = { trait = zealous }
					}
					add_trait = zealous
				}
				else_if = {
					limit = {
						trait = zealous
					}
					prestige = 50
				}
			}
			25 = {
				prestige = 50
			}
		}
		hidden_tooltip = { add_character_modifier = { name = ashura_timer years = 3 } } 
	}
}

character_event = { 
	id = islamate.25
	desc = EVTDESC_ashura_6
	picture = GFX_evt_imam
	border = GFX_event_normal_frame_religion
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = ashura_fast
	}
	
	immediate = {
		clr_character_flag = ashura_fast
	}
	
	option = {
		name = EVTOPTA_ashura_6
		trigger = { war = no }
		if = {
			limit = {
				NOT = {
					has_dlc = "Reapers"
				}
			}
			add_trait = ill
		}
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			add_symptom_effect = yes
		}
		piety = 30
	}
	
	option = {
		name = EVTOPTB_ashura_6
		trigger = { war = no }
		piety = -20
	}
	
	option = {
		name = EVTOPTC_ashura_6
		trigger = { war = yes }
	}
}

character_event = { 
	id = islamate.26
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = ashura_in_progress
		clr_character_flag = ashura_fast
		clr_character_flag = do_not_disturb
		clr_character_flag = recent_minor_decision
	}
}

# War interrupts Ashura
character_event = {
	id = islamate.27
	desc = EVTDESC_ashura_7
	picture = GFX_evt_moors
	border =  GFX_event_normal_frame_religion
	has_character_flag = ashura_in_progress
	war = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = EVTOPTA_ashura_7
		wealth = 100
		piety = -50
		prestige = 25
		hidden_tooltip = { character_event = { id = islamate.26 } }
		hidden_tooltip = { add_character_modifier = { name = ashura_timer years = 3 } }
	}
}