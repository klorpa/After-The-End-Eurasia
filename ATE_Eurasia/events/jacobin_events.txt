namespace = jacobin
character_event = {
	id = jacobin.1
	desc = "EVTDESC_jacobin1"
	picture = GFX_evt_open_book_hf
	border = GFX_event_normal_frame_religion
	religion = jacobin
	is_triggered_only = yes
	
	trigger = {
		NOT = {
			has_alternate_start_parameter = { key = religion_names value = random }
		}
	}
	
	option = {
		name = EVTOPTA_jacobin1
		hidden_tooltip = {
			remove_trait = patron_the_emperor
			remove_trait = patron_the_general

		}
		add_trait = patron_marianne
		ai_chance = {
			factor = 10
		}
	}

	option = {
		name = EVTOPTB_jacobin1
		hidden_tooltip = {
			remove_trait = patron_the_general
			remove_trait = patron_marianne

		}
		add_trait = patron_the_emperor
		ai_chance = {
			factor = 10
		}
	}
	
	option = {
		name = EVTOPTC_jacobin1
		hidden_tooltip = {
			remove_trait = patron_the_emperor
			remove_trait = patron_marianne

		}
		add_trait = patron_the_general
		ai_chance = {
			factor = 10
		}
	}
}


#Bastille Day
# Invitation Sent
narrative_event = {
	id = jacobin.2
	title = EVTTITLE_bastilleday_1
	desc = EVTDESC_bastilleday_1
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	hide_from = yes
	
	option = {
		name = EVTOPTA_bastilleday_1
		any_vassal = {
			limit = {
				religion = jacobin
				prisoner = no
				war = no
				NOT = { trait = incapable }
			}
			character_event = { id = jacobin.3 days = 2 tooltip = EVTTOOLTIP_bastilleday_1 }
		}
		custom_tooltip = { text = bastille_day_invitations_sent }
		hidden_tooltip = { character_event = { id = jacobin.4 days = 2 } }
		hidden_tooltip = { character_event = { id = jacobin.6 days = 10 } }

	}
}

# Invitation Received
character_event = {
	id = jacobin.3
	desc = EVTDESC_bastilleday_2
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	trigger = { NOT = { is_inaccessible_trigger = yes } }
	
	option = {
		name = EVTOPTA_bastilleday_2
		ai_chance = {
			factor = 95
			modifier = {
				factor = 0
				opinion = { who = ROOT value <= -20 }
			}
		}
		custom_tooltip = { text = bastille_day_accepted }
		set_character_flag = attending_bastille_day
		set_character_flag = do_not_disturb
		hidden_tooltip = { character_event = { id = jacobin.6 days = 8 } }
		hidden_tooltip = { character_event = { id = jacobin.12 days = 20 } } # Safety catch flag clearing
	}
	option = {
		name = EVTOPTB_bastilleday_2
		ai_chance = {
			factor = 5
		}
		FROM = {
			opinion = {
				modifier = opinion_refused_bastille_day
				who = ROOT
			}
		}
		custom_tooltip = { text = bastille_day_declined }
		hidden_tooltip = {
			FROM = { character_event = { id = jacobin.4 } }
		}
	}
}

# Invitation Refused
character_event = {
	id = jacobin.4
	desc = EVTDESC_bastilleday_3
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_bastilleday_3
		opinion = {
			modifier = opinion_refused_bastille_day
			who = FROM
		}
	}
}

#Marianne Selection
character_event = {
	id = jacobin.5
	desc = EVTDESC_bastilleday_4
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	trigger = {
		any_courtier = {
			count >= 2
			is_female = yes
			age = 16
			NOT = { age = 40 }
		}
	}
	
	immediate = {
		any_courtier = {
			limit = {
				is_female = yes
				age = 16
				NOT = { age = 40 }
			}
			set_character_flag = marianne_1
			save_event_target_as = marianne_candidate_1
		}
		any_courtier = {
			limit = {
				is_female = yes
				age = 16
				NOT = { age = 40 }
				NOT = { has_character_flag = marianne_1 }
			}
			save_event_target_as = marianne_candidate_2
		}
	}
	option = {
		name = EVTOPTA_bastilleday_4
		event_target:marianne_candidate_1 = {
			opinion = {
				modifier = opinion_marianne_selection 
				who = ROOT
			}
			save_event_target_as = marianne
			clr_character_flag = marianne_1
		}
	}
		
	option = {
		name = EVTOPTB_bastilleday_4
		event_target:marianne_candidate_2 = {
			opinion = {
				modifier = opinion_marianne_selection 
				who = ROOT
			}
			save_event_target_as = marianne
		}
		event_target:marianne_candidate_1 = {
			clr_character_flag = marianne_1
		}
		hidden_tooltip = {
			character_event = { id = jacobin.6 days = 4 }
		}
	}
	
	after = {
		clear_event_target = marianne_candidate_1
		clear_event_target = marianne_candidate_2
	}
}


# Bastille Day Begins
character_event = {
	id = jacobin.6
	desc = EVTDESC_bastilleday_5
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			has_character_flag = holding_bastille_day
		}
		name = EVTOPTA_bastilleday_5
		hidden_tooltip = {
			random_list = {
				50 = { character_event = { id = jacobin.7 days = 1 } } 
				50 = { 
					modifier = {
						factor = 0
						num_of_prisoners <= 2
					}
					character_event = { id = jacobin.8 days = 1 } 
				} 
				50 = { character_event = { id = jacobin.9 days = 1 } } 
			}
			character_event = { id = jacobin.10 days = 2 }
		}
		event_target:marianne = {
			add_character_modifier = {
				name = impersonated_marianne
				duration = 1825
			}
		}
	}
	option = {
		trigger = {
			has_character_flag = attending_bastille_day
		}
		name = EVTOPTB_bastilleday_5
	}
}

# some event IDK
character_event = {
	id = jacobin.7
	desc = EVTDESC_bastilleday_6
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_bastilleday_6
	}
}

# Freeing the prisoners?
character_event = {
	id = jacobin.8
	desc = EVTDESC_bastilleday_7
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_bastilleday_7
		any_courtier = {
			limit = {
				prisoner = yes
			}
			count = 2
			imprison = no
		}
		piety = 50
		prestige = 50
	}
	option = {
		name = EVTOPTB_bastilleday_7
	}
	option = {
		trigger = {
			trait = cruel
			trait = impaler
			trait = lunatic
			trait = possessed
		}
		name = EVTOPTC_bastilleday_7
		any_courtier = {
			limit = {
				prisoner = yes
			}
			count = 2	
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		piety = -50
	}
}

# some other event IDK
character_event = {
	id = jacobin.9
	desc = EVTDESC_bastilleday_8
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_bastilleday_8
	}
}




# Bastille Day Ends (Host)
character_event = {
	id = jacobin.10
	desc = EVTDESC_bastilleday_9
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	hide_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_bastilleday_9
		any_vassal = {
			limit = { has_character_flag = attending_bastille_day }
			opinion = {
				modifier = opinion_bastille_day
				who = ROOT
			}
		}
		hidden_tooltip = {
			any_vassal = {
				limit = { has_character_flag = attending_bastille_day }
				character_event = { id = jacobin.11 }
			}
		}
		add_character_modifier = {
			name = held_bastille_day_timer
			duration = 1825
			hidden = yes
		}
		prestige = 100
		piety = 100
		clr_character_flag = holding_bastille_day
		clr_character_flag = do_not_disturb
		clear_event_target = marianne
	}
}

# Bastille Day Ends (Guest)
character_event = {
	id = jacobin.11
	desc = EVTDESC_bastilleday_10
	picture = GFX_evt_bastille_day
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA_bastilleday_10
		clr_character_flag = attending_bastille_day
		clr_character_flag = do_not_disturb
	}
}




# Safety catch - clears character flags and modifiers
character_event = {
	id = jacobin.12

	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = do_not_disturb
		clr_character_flag = holding_bastille_day
		clr_character_flag = attending_bastille_day
	}
}