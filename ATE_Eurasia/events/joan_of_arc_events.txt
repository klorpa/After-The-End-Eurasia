
namespace = joan

narrative_event = { #Some crazy fucknut claims to liberate the cursed city of Paris
	id = joan.1 
	title = EVTTITLE_joan_1
	desc = EVTDESC_joan_1
	picture = GFX_evt_bandits
	
	major = yes
	
	only_independent = yes 
	only_playable = yes

	trigger = {
		NOT = {
			has_global_flag = joan_of_arc_revolt_spawned
		}
		NOR = {
			religion = jacobin
			religion = chronicler
			religion = sun_king_cultist 
		}
		NOT = {government = merchant_republic_government}
		OR = {
			has_landed_title = d_ile_de_france
			any_realm_character = { has_landed_title = d_ile_de_france }
		}
		OR = { 
			primary_title = { tier = EMPEROR }
			primary_title = { tier = KING }
		}
	}
	mean_time_to_happen = {
		months = 20
	}
	immediate = {
		set_global_flag = joan_of_arc_revolt_spawned
		1551 = {
			hidden_tooltip = { 
				province_event = { id = joan.2 } 
			}
		}
	}
	option = {#locs for frenchies
		name = EVTOPTA_joan_1
		trigger = {
			NOR = {
				religion = jacobin
				religion = sun_king_cultist
				religion = chronicler
			}
		}
	}
	option = {#locs for non french
		name = EVTOPTB_joan_1
		trigger = {
			OR = {
				religion = jacobin
				religion = sun_king_cultist
				religion = chronicler
			}
		}
	}
}

province_event = {#creates joan and her armies
	id = joan.2
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		create_character = {
			random_traits = no
			religion = ROOT
			name = "Jeanne"
			dynasty = 2009230 #Larch√®re
			culture = parisian
			age = 25
			female = yes
			trait = brilliant_strategist
			trait = holy_warrior
			trait = shrewd
			trait = mystic
			trait = chaste
			trait = wroth
			trait = zealous
			trait = humble
			trait = possessed
			trait = is_malnourished
			attributes = {
				diplomacy = 6
				martial = 9
				stewardship = 5
				intrigue = 7
				learning = 9
			}
		}
		new_character = {
			character_event = { id = maintenance.4 } #diversity
			set_character_flag = is_joan
			set_defacto_liege = THIS
			prestige = 100
			piety = 50
			add_claim = d_ile_de_france
			random_list = {
				40 = {
					religion = sun_king_cultist
				}
				40 = {
					religion = jacobin
				}
				20 = {
					religion = chronicler
				}
				100 = {	
					trigger = {
						OR = {
							religion = sun_king_cultist 
							religion = jacobin
							religion = chronicler
						}
					}
					religion = THIS #doesn't change her religion
				}
			}
			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				culture = parisian
				name = JOAN_ARMY
				holder = THIS
			}
			
			##unit size may be adjusted later
			spawn_unit = {
				province = ROOT
				home = ROOT
				owner = THIS
				leader = THIS
				match_character = FROM
				match_mult = 0.25
				match_min = 300
				match_max = 5000
				attrition = 0.5
				cannot_inherit = yes
			}
			spawn_unit = {
				province = ROOT
				home = ROOT
				owner = THIS
				leader = THIS
				match_character = FROM
				match_mult = 0.25
				match_min = 300
				match_max = 5000
				attrition = 0.5
				cannot_inherit = yes
			}
			spawn_unit = {
				province = ROOT
				home = ROOT
				owner = THIS
				leader = THIS
				match_character = FROM
				match_mult = 0.25
				match_min = 300
				match_max = 5000
				attrition = 0.5
				cannot_inherit = yes
			}
			spawn_unit = {
				province = ROOT
				home = ROOT
				owner = THIS
				leader = THIS
				match_character = FROM
				match_mult = 0.25
				match_min = 300
				match_max = 5000
				attrition = 0.5
				cannot_inherit = yes
			}
			if = {
				limit = {
					FROM = { any_realm_title = { title = d_ile_de_france } }
				}
				d_ile_de_france = {
					FROM = {
						reverse_war = {
							target = PREVPREV
							casus_belli = joan_revolt
							thirdparty_title = PREV
						}
					}
				}
			}
			character_event = {id = joan.3 days = 3}
		}	
	}
}

character_event = {#Ping event so that joan is the FROM in joan.4, no one sees it.
	id = joan.3
	hide_window = yes # we can repurpose it into a visible event for joan for a little better explanation
	is_triggered_only = yes
	immediate = {
		any_independent_ruler = {
			limit = {
				religion = PREV
				war = no
			}
			letter_event = { id = joan.4 }
		}
	}
}

letter_event = { #Good ol' Jeanne wants yo troops
	id = joan.4
	desc = EVTDESC_joan_4

	is_triggered_only = yes

	trigger = {
		war = no 
		religion = FROM
	}
	option = { #yes
		name = EVTOPTA_joan_4
		join_attacker_wars = FROM

		ai_chance = {
			factor = 100
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = zealous
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 0.1
				trait = craven
			}
			modifier = {
				factor = 0.6
				trait = cynical
			}
			modifier = {
				factor = 0.8
				trait = kind
			}
		}
	}

	option = { #no
		name = EVTOPTB_joan_4
		prestige = -25
		piety = -50

		ai_chance = {
			factor = 10
			modifier = {
				factor = 0
				trait = brave
			}
			modifier = {
				factor = 0
				trait = zealous
			}
			modifier = {
				factor = 3
				trait = craven
			}
			modifier = {
				factor = 2
				trait = cynical
			}
			modifier = {
				factor = 1.5
				trait = kind
			}
		}
	}
}

character_event = { #gets claims on the other infidel duchies in the french heart
	id = joan.5
	desc = EVTDESC_joan_5
	picture = GFX_evt_feast
	#border = GFX_event_narrative_frame
	#Conditions
	has_character_flag = is_joan
	is_triggered_only = yes
	immediate = {
		set_government_type = feudal_government#temporary measure until pirate gov gets reworked
	}
	option = {
		name = EVTOPTA_joan_5
		prestige = 50
		piety = 100
		grant_title = k_joan_darc
		spawn_unit = {
			province = 1551
			home = 1551
			owner = ROOT
			troops = {
				light_cavalry = { 400 400 }
				light_infantry = { 1200 1200 }
				heavy_infantry = { 600 600 }
				knights = { 200 200 }
				pikemen = { 400 400 }
			}
			attrition = 1.0
			reinforces = yes
			cannot_inherit = yes
		}
		spawn_unit = {
			province = 1551
			home = 1551
			owner = ROOT
			troops = {
				light_cavalry = { 400 400 }
				light_infantry = { 1200 1200 }
				heavy_infantry = { 600 600 }
				knights = { 200 200 }
				pikemen = { 400 400 }
			}
			attrition = 1.0
			reinforces = yes
			cannot_inherit = yes
		}
		#sets claims on appropriate non french duchies
		if = {
			limit = {
				d_berry = { holder_scope = { NOR = {
					religion = jacobin
					religion = chronicler
					religion = sun_king_cultist 
				}}}
			}
			add_claim = d_berry
		}
		if = {
			limit = {
				d_loire = { holder_scope = { NOR = {
					religion = jacobin
					religion = chronicler
					religion = sun_king_cultist 
				}}}
			}
			add_claim = d_loire
		}
		if = {
			limit = {
				d_nord = { holder_scope = { NOR = {
					religion = jacobin
					religion = chronicler
					religion = sun_king_cultist 
				}}}
			}
			add_claim = d_nord
		}
		if = {
			limit = {
				d_normandy = { holder_scope = { NOR = {
					religion = jacobin
					religion = chronicler
					religion = sun_king_cultist 
				}}}
			}
			add_claim = d_normandy
		}
		if = {
			limit = {
				d_orleanais = { holder_scope = { NOR = {
					religion = jacobin
					religion = chronicler
					religion = sun_king_cultist 
				}}}
			}
			add_claim = d_orleanais
		}
		if = {
			limit = {
				d_picardy = { holder_scope = { NOR = {
					religion = jacobin
					religion = chronicler
					religion = sun_king_cultist 
				}}}
			}
			add_claim = d_picardy
		}
	}
}